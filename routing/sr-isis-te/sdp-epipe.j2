{# epipe modeled as a virtual link between r1-r4 #}
updates:
{% for l in links if 'epipe_peer' in l %}
{% set peer=l.epipe_peer|ipaddr('address') %}
updates:
- path: configure/router[router-name=Base]/ldp
  val:
   admin-state: enable
   targeted-session:
    peer:
    - ip-address: "{{ peer }}"

- path: configure/service/sdp[sdp-id={{l.ifindex}}]
  val:
   admin-state: enable
   delivery-type: mpls
   sr-isis: True
   far-end:
    ip-address: "{{ peer }}"

- path: configure/service/epipe[service-name=to-{{l.epipe}}]
  val:
   admin-state: enable
   customer: "1"
   spoke-sdp:
   - sdp-bind-id: "{{ l.ifindex }}:{{ 100 + l.ifindex }}" # vc-id
     admin-state: enable
   sap:
   - sap-id: "{{ l.ifname }}/1"
     admin-state: enable
{% endfor %}
